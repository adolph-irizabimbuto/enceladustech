<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enceladus Tech | Automation</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://bootswatch.com/4/lux/bootstrap.min.css">
</head>

<style>
  .navbar {
  background-color: #3d6bf5;
  color: white;
  background-image: none;
  }
  
  .nav.navbar-nav.navbar-light li a {
      color: white;
  }
  .custom-toggler.navbar-toggler {
      border-color: lightgreen;
  }

  input, textarea{
  border-color: #dc3545;
  color: #dc3545;
  border-style:outset;
  }

  #binaryText{
    color: white;
  }

</style>

<body style="min-height: 100vh; display: flex; flex-direction: column;">
  <nav class="navbar navbar-expand-md bg-blue navbar-dark w-100">
    <a class="navbar-brand" href="index.html">Enceladus</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse w-100" id="collapsibleNavbar">
            <ul class="nav navbar-nav nav-fill w-100" >
                <li><a class = "nav-item nav-link px-2"href="music.html">Andal√∫s Music</a></li>
                <li><a class = "nav-item nav-link px-2"href="josephus.html">The Josephus Problem</a></li>
                <li><a class = "nav-item nav-link px-2"href="poerty.html">Cairo Thougths</a></li>
                <li><a class = "nav-item nav-link px-2"href="writting.html">Lahej Letters</a></li>
                <li><a class = "nav-item nav-link px-2"href="nato.html">Nato Alphabet</a></li>
                <li><a class = "nav-item nav-link px-2"href="binary.html">Binary Converter</a></li>
                <li><a class = "nav-item nav-link px-2"href="subnet.html">Subnet Calculator</a></li>
                <li><a class = "nav-item nav-link px-2"href="misr.html">Misr Blog</a></li>
            </ul>
        
    </div>  
</nav>

  <div class="jumbotron">
    <h3>Config Generator </h3>
  </div>

  <div class="container">
    <br>
    <p>
    Caveats:
    
        <ul>
            <li>The uploaded file MUST be in csv format</li>
            <li>The CSV file should contain less than 600 lines/ip addresses. That seems to be the max for an address group <br>
                You can use <a href="https://mightymerge.io/split-csv-files/" style="color: red;">this website</a>  to split a CSV fiel with more than 600 entries </li>
            <li>This will generate /32 address objects. More functionality to come...  </li>
            <li>Address Group Name i soptional</li>
        </ul>
        
       
      <br>
    </p>
    <body>
        <form id="myForm">
        <div class="container ">
            <div class="input-group mb-3">
                <!-- ticket number  -->
                <div class="input-group-prepend">
                    <span style="padding-right: 2.5rem;" class="input-group-text" >Ticket Number</span>
                    <input type="text" class="form-control" id="ticket-number" aria-label="Small" aria-describedby="inputGroup-sizing-sm">
                </div>
            </div>
             <!-- Address Group  -->
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <span class="input-group-text" >Address Group Name</span>
                    <input type="text" class="form-control" id="address-group" aria-label="Small" aria-describedby="inputGroup-sizing-sm">
                </div>
            </div>
             <!--type  -->
             <div class="input-group mb-3">
              <div class="input-group-prepend">
               <span style="padding-right: 2.5rem;" class="input-group-text" >Type</span>
              </div>
             
              <div class="col-sm-10">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="gridRadios" id="subnet-radio" value="option1" checked>
                  <label class="form-check-label" for="gridRadios1">
                    Subnet
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="gridRadios" id="fqdn-radio" value="option2">
                  <label class="form-check-label" for="gridRadios2">
                    Fully Qualified Domain Names (FQDN)
                  </label>
                </div>
              </div>
              </div>
              <br>
            <!-- upload file -->
            <label class="form-label" for="customFile">Upload CSV File</label>
            <input type="file" class="form-control" id="CSV_FILE" accept=".csv" />
            <div style="text-align: center; margin-top: 1rem;">
                <button type="submit" class="btn btn-primary" style="background-color: #DA291C;" id="">Generate Config</button>
            </div>
       
                <label for="TEXTAREA">Fortigate Config:</label>
                <textarea class="form-control" id="TEXTAREA" rows="20"></textarea>

            </div>
                  

        </form>
    </div>
    <script>
       //VARIABLES
        const MY_FORM = document.getElementById("myForm");
        const CSV_FILE = document.getElementById("CSV_FILE");
        const TEXTAREA = document.getElementById("TEXTAREA")
        const ADDR_GROUP = document.getElementById("address-group")
        const TICKET_NUMBER = document.getElementById("ticket-number")
        const FQDN = document.getElementById('fqdn-radio')
        const SUBNET = document.getElementById('subnet-radio')
    

        //Address objects
      function generateAddressObjects (IP){
        if(TICKET_NUMBER.value.length > 0){
          TEXTAREA.innerText = ""
          TEXTAREA.append("config firewall address\n")
             //iterate though the IPs 
             for  (let i = 1;  i < IP.length; i++){
              const SANITISED_IP_ADDR = IP[i].trim()
              if(SANITISED_IP_ADDR.length <= 0){
                  continue
                  TEXTAREA.append("test")
                } 
              else {
                
                TEXTAREA.append(`edit ${SANITISED_IP_ADDR}\n`)
                TEXTAREA.append(`set subnet ${SANITISED_IP_ADDR} 255.255.255.255\n`)
                TEXTAREA.append(`set comment ${TICKET_NUMBER.value} \n`)
                TEXTAREA.append("next\n") 
              }}
          TEXTAREA.append("end\n")
        }else{
                TEXTAREA.innerText = "";
                TEXTAREA.append("Error! Please enter a Ticket number")}
      }

      //Address group name
      function generateAddressGroup(IP){
        if(ADDR_GROUP.value.length > 0){
          TEXTAREA.append("config firewall addrgrp\n")
          TEXTAREA.append(`edit ${ADDR_GROUP.value}\n`)
             for  (let i = 1;  i < IP.length; i++){
              const SANITISED_IP_ADDR = IP[i].trim()  
              if(SANITISED_IP_ADDR.length <= 0){
                  continue
                }
                else{
                  TEXTAREA.append(`append member ${IP[i].trim()}\n`)
                }
             }
             TEXTAREA.append(`end`)
        } else{
          TEXTAREA.innerText = "";
          TEXTAREA.append("Error! Please enter an address-group name")}
        }
      
      //FQDN address
        function generateFQDNs(FQDNs){
          if(TICKET_NUMBER.value.length > 0){
          TEXTAREA.innerText = ""
          TEXTAREA.append("config firewall address\n")
             //iterate though the IPs 
             console.log(FQDNs)
             for  (let i = 1;  i < FQDNs.length; i++){
                const SANITISED_FQDN = FQDNs[i].trim()
                if(SANITISED_FQDN.length <= 0){
                  continue
                }
                else{
                TEXTAREA.append(`edit ${SANITISED_FQDN}\n`)
                TEXTAREA.append(`set type fqdn\n`)
                TEXTAREA.append(`set fqdn ${SANITISED_FQDN}\n`)
                TEXTAREA.append(`set comment ${TICKET_NUMBER.value} \n`)
                TEXTAREA.append("next\n") 
              }}
          TEXTAREA.append("end\n")
        }else{
                TEXTAREA.innerText = "";
                TEXTAREA.append("Error! Please enter a Ticket number")}
        }
    //EVENT LISTENER
        MY_FORM.addEventListener("submit", function (e) {
           e.preventDefault();
           const input = CSV_FILE.files[0];
           const reader = new FileReader();

           reader.onload = function (e) {
             const TEXT = e.target.result;
             const IP_ADDRESS = (TEXT.split("\r"));

             if((SUBNET.checked) && ADDR_GROUP.value.length == 0){
              generateAddressObjects(IP_ADDRESS)
             } 
             else if (FQDN.checked && ADDR_GROUP.value.length == 0){
              generateFQDNs(IP_ADDRESS)
             }
             else if (SUBNET.checked){
              generateAddressObjects(IP_ADDRESS)
              generateAddressGroup(IP_ADDRESS)
             }
             else if(FQDN.checked){
              generateFQDNs(IP_ADDRESS)
              generateAddressGroup(IP_ADDRESS)
             }
            }
          reader.readAsText(input);
        
        });
       
     </script>

<footer class="bg-body-tertiary text-center text-lg-start" style="margin-top: auto;">
  <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.05);">
    By:
    <a class="text-body" href="https://github.com/adolph-irizabimbuto">Adolph Irizabimbuto</a>
  </div>
</footer>
</html>